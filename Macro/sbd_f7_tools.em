macro BCompare(cNum){	//_TempHeadF7(hbuf)	var curPath		hwnd = GetCurrentWnd()	hbuf = GetCurrentBuf()	if (hwnd == 0)	{    	hbuf = OpenDefaultSR(hbuf)    	stop	}	curPath = GetBufName(hbuf)	if(cNum == 1)	{		//目录对比		curPath = getBaseDir(curPath, 0)	}	BComparePath(hbuf, curPath)}macro BComparePath(hbuf, curPath){	var curVal	var tarVal	var curAlias	var tarAlias	var tarPath	baseDir = getBasePath(hbuf)	//非项目文件可能报错	if(strlen(baseDir)>strlen(curPath))	{		stop	}	else if(strmid(curPath, 0, strlen(baseDir)) != baseDir)	{		// 区分大小写, 只用管 save		str = "非项目文件不能对比"		     # CharFromKey(13) # "--" # strmid(curPath, 0, strlen(baseDir)) # "--"		     # CharFromKey(13) # "--" # baseDir # "--"		msg(str)		stop	}	curVal = getBaseDirNum(curPath)	tarPath = strmid(curPath, strlen(baseDir), strlen(curPath))		vbit = 100         //1000	valAll  = ReadMode(getBCompareRow(0))//1~6	val_old = valAll/vbit	tarVal     = valAll - (valAll/vbit)*vbit	if(tarVal == curVal)	{		//避免当前项目与自己对比		tarVal = val_old	}		//有些路径名称不一样, 替换掉	curtype = curVal/10 *10	tartype = tarVal/10 *10	curAlias = getBaseOther(curtype, "alias")	tarAlias = getBaseOther(tartype, "alias")	if((curAlias == "8910" || curAlias == "107") && (tarAlias == "6531D" || tarAlias == "6531E"))	{		tarPath = strmid(curPath, strlen(baseDir), strlen(curPath))		tarPath = ReplaceWord(tarPath, "MS_MMI_Main", "MS_MMI")	}	else if((tarAlias == "8910" || tarAlias == "107") && (curAlias == "6531D" || curAlias == "6531E"))	{		tarPath = strmid(curPath, strlen(baseDir), strlen(curPath))		tarPath = ReplaceWord(tarPath, "MS_MMI", "MS_MMI_Main")	}	else if(tarVal >= 80 && curVal >= 80 && tarVal != curVal)	{		tarPath = strmid(curPath, strlen(baseDir), strlen(curPath))		reOld = ""		reNew = ""				if(curVal == 80)			reOld = "FARSIGHTED61M_CN"		else if(curVal == 82)			reOld = "BLEPHONE61A"		else if(curVal == 84)			reOld = "BLEPHONE61D"		else if(curVal == 86)			reOld = "BLEPHONE61D"		else			stop					if(tarVal == 80)			reNew = "FARSIGHTED61M_CN"		else if(tarVal == 82)			reNew = "BLEPHONE61A"		else if(tarVal == 84)			reNew = "BLEPHONE61D"		else if(tarVal == 86)			reNew = "BLEPHONE61D"		else			stop					//BLEPHONE61A_11C_BB, BLEPHONE61A, BLEPHONE61D//		tarPath = ReplaceWord(tarPath, "BLEPHONE61A_11C_BB", "FARSIGHTED61M_CN_11C_BB")//		tarPath = ReplaceWord(tarPath, "BLEPHONE61A_11C_LCM", "FARSIGHTED61M_CN_11C_LCM")//		tarPath = ReplaceWord(tarPath, "FARSIGHTED61M_CN", "BLEPHONE61A")		if(reOld != reOld)			tarPath = ReplaceWord(tarPath, reOld, reNew)				}	else if((curAlias == "base"))	{		hbufConfig = GetPubKeyBuf(0)		tarVal = SearchNumFromKey(hbufConfig, "base_pri", "key")	}	else	{		//msg("@curVal@ @curAlias@ , @tarVal@ @tarAlias@" # CharFromKey(13) # "<full> @curPath@ " # CharFromKey(13) # "<sub>  @tarPath@")		//stop	}	//msg("@curVal@ @curAlias@ , @tarVal@ @tarAlias@" # CharFromKey(13) # "<full> @curPath@ " # CharFromKey(13) # "<sub>  @tarPath@")		//合并路径, 加上项目目录	tarPath = SearchPathFromNum("", tarVal) # tarPath	//msg("@curVal@ @curAlias@ , @tarVal@ @tarAlias@" # CharFromKey(13) # "<cur> @curPath@ " # CharFromKey(13) # "<tar>  @tarPath@")	if (tarPath != "")	{		ShellBCompare(curPath, tarPath)	}}macro BComSetPath(s){	//_TempHeadF7(hbuf)	var curVal	var tarVal	var curAlias	var tarAlias	var curPath	var tarPath		curV = 0	hbuf = GetCurrentBuf()	if (hbuf != 0)	{		szpathName = GetBufName(hbuf)		filename = GetFileName(szpathName)		//增加功能：A->B比; B->A比; 避免A->A比		curV = getBaseDirNum(szpathName)	}	val = ReadMode(getBCompareRow(0))	curVal = (val/100)	tarVal = val - curVal*100	ShowBCompareMode(curVal, tarVal, curV)		//获取目录设置值: 10~80	mode = 0	bit = 2	while (bit > 0)	{		key = GetKey()		//输入0-9a-z, 返回0-9+26		i = GetNumFromKey(key, 10 - 1)		if(i >= 0)		{			mode = mode*10+i		}		bit = bit - 1	}	if (mode>0)	{		//if(val2 != mode)		{			n = curV*100 + mode			SaveMode(getBCompareRow(0), "@n@")		}		msg ("set ok!    (@curV@ -> @mode@)")	}	else	{		msg (CharFromKey(key) # " @key@")	}}//testmacro ShowBCompareMode(val1, val2, curV){	//_TempHeadF7(hbuf)	var hbufConfig	hbufConfig = GetPubKeyBuf(0)	n1 = 1	n2 = 0	//对比目录为10~80之间	bComMsg = "BCompare Mode : [@val1@ ~ @val2@] -> [@curV@ ~ ?]" # CharFromKey(13)	while (n1 < 9)	{		path = SearchPathFromNum(hbufConfig, n1*10+n2) //路径列表		if("" == path){			if(0 == n2){				n1 = n1 + 1				continue			}		}else{		    //msg(n1 # " " # n2 # ":" # path)			bComMsg = bComMsg # n1 # n2 # ": " # path # CharFromKey(13)		}		n2 = n2 + 1		if(9 < n2){			n2 = 0			n1 = n1 + 1		}	}		msg ("@bComMsg@")}macro BCompareSel(key){	//_TempHeadF7(hbuf)	onoff = ReadMode(getBCompareOnOff(0))	    hbuf = GetCurrentBuf()	if (hwnd == 0)	{    	stop	}		sel = MGetWndSel(hbuf)	if (!IsHasSelect(sel))	{		return	}		if (onoff == 1)	{		tarFile = "Tmp_Comp_1.h"	}	else	{		tarFile = "Tmp_Comp_2.h"	}		    tmpBuf = OpenCache(getTXTPath(0) # "\\" # tarFile)    EmptyCache(tmpBuf)    	cRow = sel.lnFirst	while (cRow <= sel.lnLast)	{		AppendBufLine(tmpBuf, GetBufLine( hbuf, cRow))		cRow = cRow + 1	}	SaveBuf(tmpBuf)	CloseBuf(tmpBuf)					if (onoff == 1)	{		onoff = 2	}	else	{		onoff = 1	}	SaveMode(getBCompareOnOff(0), "@onoff@")		if (onoff == 2)	{		onoff = 2		ShellBCompare(getTXTPath(0) # "\\Tmp_Comp_1.h", getTXTPath(0) # "\\Tmp_Comp_2.h")	}}macro BComparePatch(cNum){	//cNum 0:file, 1:dir, 2:bat	//_TempHeadF7(hbuf)	var curPath	var tarPath	var baseDir		hwnd = GetCurrentWnd()	hbuf = GetCurrentBuf()	if (hwnd == 0)	{    	hbuf = OpenDefaultSR(hbuf)    	stop	}	if(cNum == 0)	{		//file		curPath = GetBufName(hbuf)	}	else if(cNum == 1)	{		//dir		curPath = GetBufName(hbuf)		curPath = getBaseDir(curPath, 0)	}	else if(cNum == 2)	{		//bat		sel = MGetWndSel(hbuf)		cur_line = GetBufLine(hbuf, sel.lnFirst )			firstS = StartWS(cur_line, 0 )		len = strlen(cur_line)		if (firstS == "X")			stop		else if (firstS > 0)			cur_line = strmid(cur_line, firstS, strlen(cur_line))		firstE = GetTransCmdE(cur_line, firstS,     len)		curPath = strmid(cur_line, firstS, firstE)		// 去掉head		curPath = ReAllTransHead(hbuf, curPath)		// 替换普通key:		tmpPath = ReAllKeyHead(hbuf, curPath)		// 替换特殊key: 		tmpPath = ReCustomKeyHead(hbuf, "", tmpPath)		if(tmpPath != "")			curPath = tmpPath		//文件名转化:		curPath = GetTransFileName(hbuf, curPath, 5)	}	else	{		stop	}		baseDir = getBasePath(hbuf)	//非项目文件可能报错	if(strlen(baseDir)>strlen(curPath))	{		stop	}	else if(strmid(curPath, 0, strlen(baseDir)) != baseDir)	{		// 区分大小写, 只用管 save		str = "非项目文件不能对比"		     # CharFromKey(13) # "--" # strmid(curPath, 0, strlen(baseDir)) # "--"		     # CharFromKey(13) # "--" # baseDir # "--"		msg(str)		stop	}	curIsF = IsExistFile(curPath)		if(cNum == 0 || cNum == 1)	{		//移除根目录		tarPath = strmid(curPath, strlen(baseDir), strlen(curPath))		//从key查找路径		patchPath = getKeyHead(hbuf, "patch")		subPath   = getKeyHead(hbuf, "1")				//合并路径, 加上目录		tarPath = patchPath # "\\" # subPath # tarPath	}	else if(cNum == 2)	{		tarPath = getMacroValue(hbuf, "dPatch", 1)		if(tarPath != ""){			// 去掉head			tarPath = ReAllTransHead(hbuf, tarPath)			//替换普通key:			tmpPath = ReAllKeyHead(hbuf, tarPath)			//替换特殊key: 			tmpPath = ReCustomKeyHead(hbuf, "", tmpPath)			if(tmpPath != "")				tarPath = tmpPath			//文件名转化:			tarPath = GetTransFileName(hbuf, tarPath, 5)		}		isF = IsExistFile(curPath)		if(!isF)			strDefFile = getCopyPath(0) # "\\Macro_z_null.py"		if(curIsF)		{			filename = GetFileName(curPath)			tarPath = tarPath # "\\" # filename		}	}	//msg("<cur> @curPath@ " # CharFromKey(13) # "<tar>  @tarPath@")	if (tarPath != "")	{		if(curIsF)		{			tarIsF = IsExistFile(tarPath)			if(!tarIsF && cNum != 1)			{				prePath = getBaseDir(tarPath, 0)				// 如果目录不存在，复制不了				cmdStr = "copy " # curPath # " " # prePath				msg("copy文件: " # CharFromKey(13) # cmdStr)				ShellOpenCustomCmd(cmdStr)			}			else			{				ShellBCompare(tarPath, curPath)			}		}		else		{			ShellBCompare(tarPath, curPath)		}	}}/***********************************************************************//****************************    SVN  *********************************//***********************************************************************/macro SVN(key){	//_TempHeadF7(hbuf)    SvnUpdate()    SvnCommit(key)}macro SvnUpdate(key){	//_TempHeadF7(hbuf)    hwnd = GetCurrentWnd()    hbuf = GetCurrentBuf()	if (hwnd == 0)	{    	stop	}			//在搜索结果窗口，更新根目录	baseDir = getBasePath(hbuf)	ShellSvnUpdate(baseDir)}macro SvnCommit(key){	//_TempHeadF7(hbuf)    hwnd = GetCurrentWnd()    hbuf = GetCurrentBuf()	if (hwnd == 0)	{    	stop	}			curPath = getSVNCommitPath(hbuf)	//msg ("curPath  " #  "@curPath@")	ShellSvnCommit(curPath)    }//上传目录：//    project\XXX//    MS_Customize//    MS_MMI\\source\\mmi_appmacro getSVNCommitPath(hbuf){	//_TempHeadF7(hbuf)	//获取目录 6531XX:	pathName = GetBufName(hbuf)	baseDir = getBasePath(hbuf)			ret = CompareEx(pathName, "@baseDir@\\MS_Customize", 1)	if(ret ==0)	{		return "@baseDir@\\MS_Customize"	}		ret = CompareEx(pathName, "@baseDir@\\MS_MMI\\source\\mmi_app", 1)	if(ret ==0)	{		return "@baseDir@\\MS_MMI\\source\\mmi_app"	}		ret = CompareEx(pathName, "@baseDir@\\project", 1)//left 包含 right(包含6531XX/project)	if(ret ==0)	{		index = SplitMacro(pathName, "\\", strlen("@baseDir@\\project")+1, strlen(pathName))		return strmid(pathName, 0, index)	}	return baseDir # "\\project"}